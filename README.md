# PressureAdvanceTestPostscript
Постскрипт для подбора правильного pressure advance (linear advance)

Данный скрипт предназначен для обработки g-code, сгенерированного слайсером. Суть обработки в расстановке  разных коэффициентов pressure advance по копиям объектов, с целью определения лучшего коэффициента для конкретного принтера и филамента.
В комплекте представлены файлы 3mf с подготовленными моделями для слайсеров PrusaSlicer и QIDISlicer. Хотя QIDISlicer и основан на PrusaSlicer, обратной совместимости у них нет.
Проект представляет из себя набор кубиков (по умолчанию 20), подготовленных для теста. Печатается три слоя сплошных, а затем стенки в два периметра. Такой формат позволяет довольно точно подобрать PA, поскольку показывает сразу несколько возможных дефектов - внешние углы, образование дырок в периметрах на углах и наплывы на верхнем слое.

## Подготовка файла g-code для обработки скриптом
Откройте проект в слайсере. Выберите свой принтер, филамент и настройки печати. Выполните нарезку модели и экспортируйте код в файл. 
Запустите скрипт, укажите файл, задайте старовый и конечный PA и выполните обработку. Для проверки можете открыть полученный файл в просмотрщике g-code, например в Prusa G-Code Viewer.
Загрузите полученный файл на принтер и напечатайте.

## Особенности работы скрипта:
Выходной файл генерируется в каталог output, если вы просто скопировали скрипт - позаботьтесь, чтобы он был в той же папке, где и скрипт
Консольная версия скрипта ищет файлы в каталоге input

Формат имени выходного файла - PA_Test_{количество кубиков}pcs_{стартовый PA}-{конечный PA}_{тип филамента}_{температура}.gcode

Для корректной обработки есть три требования
* в настройках печати в разделе "Выходные параметры" должен быть включен параметр "Подробный G-код"
* там же параметр "Название моделей" необходимо установить в значение "Зависит от прошивки"
* в настройках принтера должно быть установлено "Использовать относительные координаты для экструдера (Е)"
Поскольку диапазон PA задается вручную и равномерно распределяется на количество кубиков - получаемый шаг может содержать много цифр после точки. Но он округляется и последний коэффициент в полученном ряду может сильно отличаться от заданного конечного. Учтите этот момент и просматривайте список генерируемых значений.

## Пример сгенерированного файла

![image](https://github.com/user-attachments/assets/6acffdad-f4d7-464c-a074-96d842665527)

# Требования

Скрипт представлен в двух вариантах - как есть и в виде исполняемого exe файла, собранного с помощью pyinstaller.

Для разработки использовался Python 3.13, возможно будет работать и на версиях ниже, не проверял.

Версия c GUI сделана с использованием PySimpleGUI, который требует лицензии. Для личного использования лицензия бесплатна сроком на год, продление тоже бесплатно. Но все это требует времени на регистрацию на сайте PySimpleGUI и возможны дальнейшие изменения.

Поэтому собран и простой консольный exe-файл с той же функциональностью.

# Интерпретация результатов

Внимательно рассматриваем получившиеся детальки. Если печатались на PET/PEI - лучше снять лист со стола, пока он горячий и детальки не отлипли (речь про PETG и ABS) и рассмотреть все в сборе. Сразу будут видны слишком высокий и слишком низкий PA. Их отбраковываем.

Далее смотрим оставшиеся. Обращаем внимание на периметры по дну и стенки, а также на верхний слой дна.

![image](https://github.com/user-attachments/assets/fd87c810-5393-475e-985f-72c93f9e1445)


Вот пример слишком низкого коэффициента - закругленные углы, рваный шов, наплывы заполнения верхнего слоя

![image](https://github.com/user-attachments/assets/a5ed1ef9-1db7-473a-9933-7f8da348d15b)

Или слишком высокого - тоже закругленные углы, а еще проблемы с ретрактом

![image](https://github.com/user-attachments/assets/a631aa9c-5644-49bb-9249-84178d97b917)

Вот уже более-менее, но присутствует проблема на верхнем слое - правый периметр


А теперь смотрим на три кандидата на роль подходящего коэффициента

![image](https://github.com/user-attachments/assets/225dee16-33e5-429a-a5fa-f31a2defbf87)

Ну верхний затесался явно зря, но все же глянем его на просвет

![image](https://github.com/user-attachments/assets/b737b267-d2e9-44ca-8d59-8249cf3595a4)

Да, явно не подходит, на просвет видны разрывы по углам, PA маловат, следующий!

![image](https://github.com/user-attachments/assets/015f5d64-1612-48a4-926b-5709182888ef)

Уже намного лучше, достаточно ровно, но не останавливаемся на этом....

![image](https://github.com/user-attachments/assets/c7cde942-9713-45df-8dea-bf5f3c154198)

И вот он наш победитель! Никаких пропусков, все равномерно залито

Ну и чтобы окончательно удостовериться, глянем следующего

![image](https://github.com/user-attachments/assets/70012127-6636-41ed-ac54-37db7ad501cf)

И тут же понимаем, что это уже перебор.

Однако на 0.06 присутствуют проблемы с углами - а это повод прогнать от 0.055 до 0.06 с более мелким шагом и подобрать температуру, поскольку наплывы на углах - это не только неправильный PA, сколько перегрев и/или недостаток охлаждения.

Удачной и качественной печати!





